<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      MyBatis实现增删改查 | Myifeng 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="ifeng">
    
    

    <meta name="description" content="好久不写这个博客。hexo命令都玩不转了，折腾了好久终于可以则是成功。开始今天的博客内容。时代总是向前发展，java也是这样，讨厌了Hibernate的各种复杂关系，然后开始接触MyBatis。顿时有种山重水复疑无路，柳暗花明又一村的赶脚。熟悉的SQL语句再次出现在代码中，简介而方便。下面简单写一个MyBatis实现的用户的增删改查以及模糊查询。
整体结构
jar包MyBatis的jar包只有一个">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis实现增删改查 | Myifeng">
<meta property="og:url" content="http://myifeng.github.io/2017/05/25/MyBatis实现增删改查/index.html">
<meta property="og:site_name" content="Myifeng">
<meta property="og:description" content="好久不写这个博客。hexo命令都玩不转了，折腾了好久终于可以则是成功。开始今天的博客内容。时代总是向前发展，java也是这样，讨厌了Hibernate的各种复杂关系，然后开始接触MyBatis。顿时有种山重水复疑无路，柳暗花明又一村的赶脚。熟悉的SQL语句再次出现在代码中，简介而方便。下面简单写一个MyBatis实现的用户的增删改查以及模糊查询。
整体结构
jar包MyBatis的jar包只有一个">
<meta property="og:image" content="http://i.imgur.com/Yxa83JG.png">
<meta property="og:image" content="http://i.imgur.com/oqQJElT.png">
<meta property="og:updated_time" content="2017-05-25T11:02:44.776Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MyBatis实现增删改查 | Myifeng">
<meta name="twitter:description" content="好久不写这个博客。hexo命令都玩不转了，折腾了好久终于可以则是成功。开始今天的博客内容。时代总是向前发展，java也是这样，讨厌了Hibernate的各种复杂关系，然后开始接触MyBatis。顿时有种山重水复疑无路，柳暗花明又一村的赶脚。熟悉的SQL语句再次出现在代码中，简介而方便。下面简单写一个MyBatis实现的用户的增删改查以及模糊查询。
整体结构
jar包MyBatis的jar包只有一个">
<meta name="twitter:image" content="http://i.imgur.com/Yxa83JG.png">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">Myifeng</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          千里之行,始于足下。
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/welcome" title="" class="">欢迎</a></li>
              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">博客</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">归档</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">MyBatis实现增删改查</h1>

    

    <div class="post-meta">
      <time datetime="2017-05-25" class="post-meta__date date">2017-05-25</time> 

      <span class="post-meta__tags tags">

          

          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <p>好久不写这个博客。hexo命令都玩不转了，折腾了好久终于可以则是成功。开始今天的博客内容。<br><br>时代总是向前发展，java也是这样，讨厌了Hibernate的各种复杂关系，然后开始接触<code>MyBatis</code>。顿时有种山重水复疑无路，柳暗花明又一村的赶脚。熟悉的SQL语句再次出现在代码中，简介而方便。<br><br>下面简单写一个MyBatis实现的用户的增删改查以及模糊查询。<br></p>
<p></p><h2>整体结构</h2><br><img src="http://i.imgur.com/Yxa83JG.png" alt=""><p></p>
<p></p><h2>jar包</h2><br>MyBatis的jar包只有一个<code>mybatis-3.2.3</code>另外加上一个数据库驱动<code>mysql-connector-java-5.1.26-bin</code>.就像下面这样：<br><br><img src="http://i.imgur.com/oqQJElT.png" alt=""><br><br>相比Hibernate的一堆，MyBatis的jar包很简洁有木有<br><p></p>
<p></p><h2>配置文件</h2><br>既然要用数据库肯定要有数据库的配置文件。我是单独把数据库的配置放到了<code>db.properties</code>中:<br><p></p>
<h4>db.properties:<h4><br><br>    driver=com.mysql.jdbc.Driver<br>    url=jdbc:mysql://localhost:3306/ssh<br>    username=root<br>    password=root<br><br>然后写MyBatis的配置文件<code>mybatis.xml</code>，约束头是这样子滴：<br><br><br>    &lt;?xml version=”1.0” encoding=”UTF-8” ?&gt;<br>    &lt;!DOCTYPE configuration<br>    PUBLIC “-//mybatis.org//DTD Config 3.0//EN”<br>    “<a href="http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;" target="_blank" rel="external">http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</a><br><br>总体的配置文件是这样滴：<br><br><h4>mybatis.xml:</h4>

<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;
    &lt;!-- 导入外部的properties文件 --&gt;
    &lt;properties resource=&quot;db.properties&quot; /&gt;

    &lt;!-- 别名 --&gt;
    &lt;typeAliases&gt;
        &lt;typeAlias alias=&quot;user&quot; type=&quot;model.User&quot; /&gt;
        &lt;typeAlias alias=&quot;int&quot; type=&quot;java.lang.Integer&quot; /&gt;
        &lt;typeAlias alias=&quot;string&quot; type=&quot;java.lang.String&quot; /&gt;
    &lt;/typeAliases&gt;

    &lt;!-- 配置数据库连接 --&gt;
    &lt;environments default=&quot;development&quot;&gt;
        &lt;environment id=&quot;development&quot;&gt;
            &lt;transactionManager type=&quot;JDBC&quot; /&gt;
            &lt;dataSource type=&quot;POOLED&quot;&gt;
                &lt;property name=&quot;driver&quot; value=&quot;${driver}&quot; /&gt;
                &lt;property name=&quot;url&quot; value=&quot;${url}&quot; /&gt;
                &lt;property name=&quot;username&quot; value=&quot;${username}&quot; /&gt;
                &lt;property name=&quot;password&quot; value=&quot;${password}&quot; /&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;

    &lt;!-- 配置映射文件 --&gt;
    &lt;mappers&gt;
        &lt;mapper resource=&quot;model/User.xml&quot; /&gt;
    &lt;/mappers&gt;

&lt;/configuration&gt;
</code></pre><p></p><h2>实体类</h2><br>实体类其实没什么好写的直接上代码：<br><p></p>
<h3>model层</h3><br><h4>User.java :</h4><br><br>package model;<br>    public class User {<br>        public User(){<br><br>        }<br>        public User(String name, String pass) {<br>            super();<br>            this.name = name;<br>            this.pass = pass;<br>        }<br>        public User(Integer id, String name, String pass) {<br>            super();<br>            this.id = id;<br>            this.name = name;<br>            this.pass = pass;<br>        }<br><br>        private Integer id;<br>        private String name;<br>        private String pass;<br>        public Integer getId() {<br>            return id;<br>        }<br>        public void setId(Integer id) {<br>            this.id = id;<br>        }<br>        public String getName() {<br>            return name;<br>        }<br>        public void setName(String name) {<br>            this.name = name;<br>        }<br>        public String getPass() {<br>            return pass;<br>        }<br>        public void setPass(String pass) {<br>            this.pass = pass;<br>        }<br>    }<br><br>有了实体类就要有实体类对应的XML配置文件，当然这个也是这个增删改查的核心配置（所有的对数据库的直接操作都是在这个文件中实现的）：<br><br><h4>User.xml :</h4><br>        &lt;?xml version=”1.0” encoding=”UTF-8” ?&gt;<br>        &lt;!DOCTYPE mapper<br>        PUBLIC “-//mybatis.org//DTD Mapper 3.0//EN”<br>        “<a href="http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;" target="_blank" rel="external">http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</a><br><br>        <!-- 写入对应的实体类的包名 --><br>        <mapper namespace="model"><br><br>            <!--增加用户--><br>            <insert id="addUser" parametertype="user"><br>                insert into user (name,pass) values (#{name},#{pass})<br>            </insert><br><br>            <!--删除用户--><br>            <delete id="deleteUser" parametertype="int"><br>                delete from user where id = #{id}<br>            </delete><br><br>            <!--修改用户--><br>            <update id="updateUser" parametertype="user"><br>                update user set name=#{name} ,pass=#{pass} where id=#{id}<br>            </update><br><br>            <!--查询全部用户--><br>            <select id="queryAll" resulttype="user"><br>                select * from user<br>            </select><br><br>        </mapper><br><h3>Dao层</h3>

<h4>UserDao.java :</h4><br>        package dao;<br>        import java.util.List;<br>        import model.User;<br><br>        public interface UserDao {<br><br>            public void addUser(User user);<br><br>            public void deleteUser(int id);<br><br>            public void updateUser(User user);<br><br>            public List<user> queryAll();<br>        }<br><h3>DaoImpl层</h3><br>因为在整个实现的过程中都要使用到SqlSession，所以为了方便使用，在这里写一个<code>BaseDao</code>用来获取SqlSession：<br><br><h4>BaseDao.java :</h4>

<pre><code>package daoImpl;
import java.io.IOException;
import java.io.InputStream;
import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;
public class BaseDao {

    private static SqlSessionFactory sf;

    static{
        try {
            InputStream inputStream = Resources.getResourceAsStream(&quot;mybatisConfig.xml&quot;);
            sf = new SqlSessionFactoryBuilder().build(inputStream);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static SqlSession getSession() {
        return sf.openSession();
    }

}
</code></pre><h4>UserDaoImpl.java:</h4>

<pre><code>package daoImpl;
import java.util.List;
import org.apache.ibatis.session.SqlSession;
import model.User;
import dao.UserDao;

public class UserDaoImpl extends BaseDao implements UserDao{

    @Override
    public void addUser(User user) {
        SqlSession session = this.getSession();
        try {
            //这里的第一个参数addUser对应User.xml中方法的id
            session.insert(&quot;addUser&quot;, user);
            session.commit();
        } catch (Exception e) {
            // TODO Auto-generated catch block
            session.rollback();
            e.printStackTrace();
        }
    }

    @Override
    public void deleteUser(int id) {
        SqlSession session = this.getSession();
        try {
            session.delete(&quot;deleteUser&quot;, id);
            session.commit();
        } catch (Exception e) {
            session.rollback();
            e.printStackTrace();
        }
    }

    @Override
    public void updateUser(User user) {
        SqlSession session = this.getSession();
        try {
            session.update(&quot;updateUser&quot;, user);
            session.commit();
        } catch (Exception e) {
            session.rollback();
            e.printStackTrace();
        }

    }

    @Override
    public List&lt;User&gt; queryAll() {
        SqlSession session = this.getSession();
        List&lt;User&gt; userList = session.selectList(&quot;queryAll&quot;);        
        return userList;
    }

}
</code></pre><p></p><h2>test测试包</h2><p></p>
<p></p><h3>MyTest测试类</h3><br><p></p>
<pre><code>package test;
import java.util.List;
import model.User;
import dao.UserDao;
import daoImpl.UserDaoImpl;

public class MyTest {
    public static void main(String[] args) {

        UserDao userDao = new UserDaoImpl();

        //userDao.addUser(new User(&quot;李小康&quot;, &quot;333333&quot;));

        //userDao.deleteUser(2);

        //userDao.updateUser(new User(3, &quot;李中康&quot;, &quot;666666&quot;));

        //List&lt;User&gt; users = userDao.queryAll();

        for (User user : users) {
            System.out.println(user.getName());
        }
    }
}
</code></pre><h2 id=""><a href="#" class="headerlink" title=""></a><br></h2><p><br><br>到这里使用MyBatis实现增删改查就全部完成了。这里只实现了全部查询。后来在里面试了下使用姓名进行模糊查询。按照经验就在<strong>User.xml</strong>里面配置：<br></p>
<pre><code>&lt;!-- 模糊查询 --&gt;
&lt;select id=&quot;queryLike&quot; resultType=&quot;user&quot;&gt;
    select * from user where name like %#{name}#%
&lt;/select&gt;
</code></pre><p>然后就抛出了一个异常：<br><br>Error querying database.  Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘%’李’%’ at line 1<br><br>这是因为MyBatis中不能这么写，要改成：<br></p>
<pre><code>&lt;!-- 模糊查询，%条件% 需要concat拼接 --&gt;
&lt;select id=&quot;queryLike&quot; resultType=&quot;user&quot;&gt;
    select * from user where name like concat(concat(&apos;%&apos;,#{name}),&apos;%&apos;)
&lt;/select&gt;
</code></pre><hr>
</user></h4></h4>
  </section>

  
  
</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2016-2017. | 由<a href="http://www.myifeng.com/">锋哥</a>强力驱动 | QQ<a href="https://user.qzone.qq.com/1778349466/main">空间</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
    MathJax.Hub.Config({ 
        tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
    });
});
    </script>


    

    <script type="text/javascript" src="/path/to/awesome-toc.min.js"></script>
<script type="text/javascript">
    $.awesome_toc({        
      autoDetectHeadings: true,
      enableToTopButton: true,
      title: "INDEX",
      css: {
          fontSize: "14px",
          largeFontSize: "18px",
      },
    });
</script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
